var app=angular.module("app",["ngAnimate","AngularPrint"],function(t){t.startSymbol("[["),t.endSymbol("]]")});app.controller("AppController",function(t){}),app.controller("FrontController",function(t,e,n,a,i){t.patients=[],t.underline_word=function(e){var n=new RegExp(t.patient,"gi"),i=e.replace(n,"<strong>$&</strong>");return a.trustAsHtml(i)},t.search_pacients=function(){return""==t.patient?void(t.patients=[]):void i({method:"POST",url:base_url+"/pacients/s/"+t.patient}).then(function(e){t.patients=e.data},function(t){console.log(t)})},t.show_birthdays=function(t){var e=$(t.target),n=e.attr("data-json")?JSON.parse(e.attr("data-json")):JSON.parse(e.parent().attr("data-json"));if(0!==Object.keys(n).length&&JSON.stringify(n)!==JSON.stringify({})){var a=$("<div>",{"class":"tooltip tooltip-"+(new Date).getTime()});a.css({position:"absolute",top:e.offset().top+20+"px",left:e.offset().left+"px"});for(var i in n)a.append("<p>El pacient "+n[i].full_name+" compleix anys el dia "+n[i].date+"</p>");$("body").append(a)}},t.delete_tooltip=function(){$(".tooltip").remove()}}),app.controller("UsersController",function(t,e){t.user={},t.randomStr=function(t){for(var t=t||9,e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;t>a;a++)e+=n.charAt(Math.floor(Math.random()*n.length));return e},t.showDeleteModal=function(t){t.preventDefault();var e=$(t.target).parent().attr("href"),n=confirm("Estàs segur d'eliminar aquest usuari?");n&&(window.location.href=e)},document.querySelector(".user_json")&&(t.user=JSON.parse(document.querySelector(".user_json").innerHTML),t.user.blocked=1==t.user.blocked,t.user.password=t.randomStr(16),console.log(t.user))}),app.controller("PacientsController",function(t,e,n,a){t.pacient={},t.search="",t.patients=[],document.querySelector(".pacient_json")&&(t.pacient=JSON.parse(document.querySelector(".pacient_json").innerHTML),t.pacient.birth_date="undefined"!=typeof t.pacient.birth_date?e("date")(new Date(t.pacient.birth_date),"dd/MM/y"):"",t.pacient.age="undefined"!=typeof t.pacient.age?parseInt(t.pacient.age):""),t.putAgeFromDate=function(e){var n=/^\d{2}([./-])\d{2}\1\d{4}$/;if(e.match(n)){var a=e.split("/"),i=new Date(a[2],a[1]-1,a[0]),r=Date.now()-i.getTime(),o=new Date(r);t.pacient.age=Math.abs(o.getUTCFullYear()-1970)}else console.log("nop!")},t.showDeleteModal=function(t){t.preventDefault();var e=$(t.target).parent().attr("href"),n=confirm("Estàs segur d'eliminar aquest pacient?");n&&(window.location.href=e)},t.search_pacient=function(e){t.locationUrl=t.location+t.search.term,n({method:"POST",url:t.locationUrl}).then(function(e){t.patients=e.data},function(t){console.log(t)})},t.underline_word=function(e){var n=new RegExp(t.search.term,"gi"),i=e.replace(n,"<strong>$&</strong>");return a.trustAsHtml(i)}}),app.controller("FlashController",function(t,e){t.timeOut=!1,e(function(){t.timeOut=!0},3e3)}),app.controller("ReviewController",function(t,e,n,a){t.data=new Date,t.actualDate=new Date,t.form={},t.review=[],t.dates=[],""!=$("#review").val()&&(t.review=JSON.parse($("#review").val())),t.addDateToReview=function(n){n.preventDefault();for(var a=null,i=0;i<t.review.length;i++)if(t.isToday(t.review[i].id)){a=t.review[i];break}for(var i=0;i<t.dates.length;i++)if(t.isToday(t.dates[i].id)){a=t.dates[i];break}if(null===a){var r=new Date;t.dates.push({date:e("date")(r,"dd MMM yyyy HH:mm"),text:"",id:r.getTime()})}else t.animate=!0,t.editDateReview(a,!0)},t.submitForm=function(e){var n=t.review;n=n.concat(t.dates);var a=JSON.stringify(n);$("#review").val(a)},t.showActualHour=function(){t.actualDate=e("date")(new Date,"dd MMM yyyy HH:m")},t.isToday=function(t){return!0},t.editDateReview=function(e,a){a=a||!1,a||(t.animate=!1),t.edit=e.id,n(function(){t.animate=!1},500)},t.checkKey=function(t){},t.showReview=function(t){},t.print=function(){a.print()}}),app.controller("BillController",function(t,e,n,a,i,r){t.bill={qty:0,price_per_unit:0,discount:0,iva:0,irpf:0,total_bill:0,total_partial:0,amount_irpf:0,total:0,amount_discount:0},t.billInfo={},t.urlBillInfo="",t.clients={},t.pacients=[],t.client={},t.patient={},t.autocomplete=!1,t.widthSearchInput="100px",t.searchUrl="",t.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var n,a,i,r,o,l,c,u="",d=0;for(e=t.Base64._utf8_encode(e);d<e.length;)n=e.charCodeAt(d++),a=e.charCodeAt(d++),i=e.charCodeAt(d++),r=n>>2,o=(3&n)<<4|a>>4,l=(15&a)<<2|i>>6,c=63&i,isNaN(a)?l=c=64:isNaN(i)&&(c=64),u=u+this._keyStr.charAt(r)+this._keyStr.charAt(o)+this._keyStr.charAt(l)+this._keyStr.charAt(c);return u},decode:function(e){var n,a,i,r,o,l,c,u="",d=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");d<e.length;)r=this._keyStr.indexOf(e.charAt(d++)),o=this._keyStr.indexOf(e.charAt(d++)),l=this._keyStr.indexOf(e.charAt(d++)),c=this._keyStr.indexOf(e.charAt(d++)),n=r<<2|o>>4,a=(15&o)<<4|l>>2,i=(3&l)<<6|c,u+=String.fromCharCode(n),64!=l&&(u+=String.fromCharCode(a)),64!=c&&(u+=String.fromCharCode(i));return u=t.Base64._utf8_decode(u)},_utf8_encode:function(t){t=t.replace(/rn/g,"n");for(var e="",n=0;n<t.length;n++){var a=t.charCodeAt(n);128>a?e+=String.fromCharCode(a):a>127&&2048>a?(e+=String.fromCharCode(a>>6|192),e+=String.fromCharCode(63&a|128)):(e+=String.fromCharCode(a>>12|224),e+=String.fromCharCode(a>>6&63|128),e+=String.fromCharCode(63&a|128))}return e},_utf8_decode:function(t){for(var e="",n=0,a=c1=c2=0;n<t.length;)a=t.charCodeAt(n),128>a?(e+=String.fromCharCode(a),n++):a>191&&224>a?(c2=t.charCodeAt(n+1),e+=String.fromCharCode((31&a)<<6|63&c2),n+=2):(c2=t.charCodeAt(n+1),c3=t.charCodeAt(n+2),e+=String.fromCharCode((15&a)<<12|(63&c2)<<6|63&c3),n+=3);return e}},angular.element(r).bind("resize",function(){var e=$('input[name="client_name"]').parent();t.widthSearchInput=e.outerWidth()+20+"px"}),n(function(){var e=$('input[name="client_name"]').parent();t.widthSearchInput=e.outerWidth()+20+"px"},500),t.ask_question=function(t){t.preventDefault();var e=$(t.target).parent(),n=e.attr("href"),a=confirm("Estàs segur que vols eliminar aquesta factura?");a&&(r.location.href=n)},t.today_date=function(){t.bill.date=e("date")(new Date,"dd/MM/y")},t.underline_word=function(e){var n=new RegExp(t.client.name,"gi"),a=e.replace(n,"<strong>$&</strong>");return i.trustAsHtml(a)},t.search_clients_and_patients=function(){return""==t.client.name?void(t.autocomplete=!1):void n(function(){a({method:"POST",url:t.searchUrl+"/"+t.client.name}).then(function(e){t.pacients=e.data.patients,t.clients=e.data.clients,t.clients.length||t.pacients.length?t.autocomplete=!0:t.autocomplete=!1},function(t){console.log(t)})})},t.put_on_bill=function(e,n){"client"==n?(t.client=e,t.bill.client_id=t.client.id,t.bill.patient_id=""):(t.patient=e,t.bill.patient_id=t.patient.id,t.client.name=t.patient.full_name,t.client.address=t.patient.address,t.client.city=t.patient.city,t.client.cif=t.patient.nif,t.bill.client_id=""),t.autocomplete=!1},t.count=function(t){return new Array(t)},t.show_total=function(n,a){return t.bill.total_bill=(isNaN(n)?0:n)-(isNaN(a)?0:a),console.log(t.bill.total_bill),e("currency")(t.bill.total_bill.toFixed(2))},t.show_amount_discount=function(n,a){return t.bill.amount_discount=(isNaN(n)?0:n)*(isNaN(a)?0:a)/100,t.bill.total_partial=t.bill.total-t.bill.amount_discount,e("currency")(t.bill.amount_discount.toFixed(2))},t.show_amount_irpf=function(n,a){return-1!=a.toString().indexOf(",")&&(a=a.toString().replace(",",".")),t.bill.amount_irpf=(isNaN(n)?0:n)*(isNaN(a)?0:a)/100,e("currency")(t.bill.amount_irpf.toFixed(2))},t.autocomplete_id=function(){""!=t.bill.id&&"undefined"!=typeof t.bill.id||(t.bill.id=t.lastId+1)},t.format_date=function(t){var n=t.replace(/-/g,"/");return e("date")(new Date(n),"dd/MM/y")};var o=$("#bill");if(o.length&&"[]"!=o.html().trim()){t.bill=JSON.parse(o.html());var l=t.bill.creation_date.replace(/-/g,"/");t.bill.creation_date=e("date")(new Date(l),"dd/MM/y");var l=t.bill.expiration_date.replace(/-/g,"/");t.bill.expiration_date=e("date")(new Date(l),"dd/MM/y"),""!=t.bill.patient_id&&null!=t.bill.patient_id&&t.put_on_bill(t.bill.patient,"patient"),""!=t.bill.client_id&&null!=t.bill.client_id&&t.put_on_bill(t.bill.client,"client")}}),app.controller("TestController",function(t,e,n,a,i,r,o){t.output="",t.days=5,t.daysMail=5,t.title="",t.time=0,t.timeLoader="",t.first_time=!0,t.status=0,t.show_output=function(n,i,r){t.timeLoader="",t.time=0;var l=a(function(){3==t.timeLoader.length&&(t.timeLoader=""),t.timeLoader+="."},100);r=r||null,null!=r&&(n=n+"/"+t[r]),t.title=i,e({method:"GET",url:n}).then(function(e){a.cancel(l),t.output=o.trustAsHtml(e.data.output),t.time=e.data.time,t.status=e.status,t.first_time=!1},function(t){console.log(t)})}}),$(document).ready(function(){$("#side-menu").metisMenu(),$(".navigation").click(function(t){$("nav").toggleClass("closed"),$(".wrap-content, #footer").toggleClass("compress")})});